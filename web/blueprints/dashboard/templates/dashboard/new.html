{% extends "_layout.html" %} {% from "uploadImage.html" import upload_image %}
{% block content %}

<div class="container">
  <div class="row">
    <div class="col-md-3">
      <div class="personal-details" style="cursor:pointer">
        <img
          width="400px"
          src="{{ current_user.profile_image }}"
          alt="profile_picture"
          data-toggle="modal"
          data-target="#uploadImageModal"
        />

        {% if current_user.is_authenticated %} {{ upload_image(current_user) }}
        {% endif %}

        <h1>{{ current_user.name }}</h1>
        <ul>
          <li>
            <span style="font-weight: bold;">Department:</span>
            {{ current_user.department }}
          </li>
          <li>
            <span style="font-weight: bold;">Position:</span>
            {{ current_user.role }}
          </li>
          <li>
            <span style="font-weight: bold;">Contact:</span>
            {{ current_user.email }}
          </li>
        </ul>
      </div>
      <div class="compliments">
        <h1>
          <a
            style="text-decoration: none"
            href="{{ url_for('compliments.new') }}"
            >My Compliments</a
          >
        </h1>
        <ul>
          <h3>Compliments Given:</h3>
          {% for compliment in compliments %} {% if compliment.sender_id ==
          current_user.id %}
          <li>{{ compliment.compliment }}</li>
          <p style="font-family: monospace;">
            -<span style="font-weight: bold;">For</span>
            {{ compliment.recipient.name }}
          </p>
          {% endif %} {% endfor %}

          <h3>Compliments Received:</h3>
          {% for compliment in compliments %} {% if compliment.recipient_id ==
          current_user.id %}
          <li>{{ compliment.compliment }}</li>
          <p style="font-family: monospace;">
            -<span style="font-weight: bold;">From</span>
            {{ compliment.sender.name }}
          </p>
          {% endif %} {% endfor %}
        </ul>
      </div>
    </div>
    <div class="col-md-6">
      <div class="objectives">
        <h1>
          <a
            style="text-decoration: none"
            href="{{ url_for('objectives.show') }}"
            >Objectives</a
          >
        </h1>
        <ul>
          {% for objective in objectives %}
          <li>{{ objective.objective }}</li>
          {% endfor %}
        </ul>
        <button
          type="button"
          class="btn btn-primary"
          data-toggle="modal"
          data-target="#feedbackForm"
        >
          Request Feedback
        </button>
        <div
          class="modal fade"
          id="feedbackForm"
          tabindex="-1"
          role="dialog"
          aria-labelledby="feedbackForm"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">
                  Request Feedback Form
                </h5>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                  <div class="form-group">
                    <label for="sel1">Select recipient</label>
                    <select class="form-control" id="sel1">
                      {% for user in all_users %} {% if not user == current_user
                      %}
                      <option value="{{ user.id }}"
                        >{{ user.name }}, {{ user.role }}</option
                      >
                      {% endif %} {% endfor %}
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="formSubject">Subject</label>
                    <input
                      type="text"
                      class="form-control"
                      id="formSubject"
                      placeholder="Enter subject..."
                    />
                  </div>
                  <div class="form-group">
                    <label for="formMessage">Message</label>
                    <textarea
                      class="form-control"
                      id="formMessage"
                      rows="2"
                    ></textarea>
                  </div>
                </form>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                  <button type="button" class="btn btn-primary feedbackbtn">
                    Request Feedback
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="calendar">
        <iframe
          src="https://calendar.google.com/calendar/embed?height=600&amp;wkst=1&amp;bgcolor=%23ffffff&amp;ctz=Asia%2FKuala_Lumpur&amp;src=aGFja2luZ3Byb2R1Y3Rpdml0eUBnbWFpbC5jb20&amp;src=YWRkcmVzc2Jvb2sjY29udGFjdHNAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&amp;src=ZW4ubWFsYXlzaWEjaG9saWRheUBncm91cC52LmNhbGVuZGFyLmdvb2dsZS5jb20&amp;color=%23039BE5&amp;color=%2333B679&amp;color=%230B8043&amp;title=Worqlyfe"
          style="border-width:0"
          width="600"
          height="400"
          frameborder="0"
          scrolling="no"
        ></iframe>
      </div>
    </div>
    <div class="col-md-3">
      {% if current_user.is_manager %}
      <div class="team">
        <h1>Project Team:</h1>
        <ul>
          {% for department in departments %} {% if not department.is_manager %}
          <li>{{ department.name }}, {{ department.role }}</li>
          {% endif %} {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>
  $(".feedbackbtn").on("click", function(e) {
    id = $("#sel1").val();
    $.ajax({
      url: `/dashboard/feedback/${id}`,
      method: "POST",
      success: function(resp) {
        $("#feedbackForm").modal("hide");
        console.log(resp);
      }
    });
  });

  $("input[type='file']").on("change", function(event) {
    let url = URL.createObjectURL(event.target.files[0]);
    console.log("url: ", url);
    $("#preview_image").attr("src", url);
  });
</script>

{% endblock %}
